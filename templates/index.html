{% extends "base.html" %}
{% block title %}Home - RecSys-MRI{% endblock %}

{% block content %}
<section class="mb-12 scroll-animate">
    <div class="bg-gradient-to-br from-indigo-50 dark:from-gray-900 to-purple-100 dark:to-gray-800 py-12 rounded-2xl shadow-[0px_0px_15px_0px] shadow-indigo-100/60 dark:shadow-black/30">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-6">
                <span class="bg-gradient-to-r from-text-gradient-start to-text-gradient-end bg-clip-text text-transparent">
                    RecSys-MRI
                </span>
            </h1>
            <p class="text-text-secondary dark:text-text-secondary text-lg mb-8">
                Your personalized platform for learning and collaboration.
            </p>
             {% if user %}
             <p class="text-text-secondary dark:text-text-secondary text-md">Welcome back, {{ user.name or user.email }}!</p>
             {% else %}
             <p class="text-text-secondary dark:text-text-secondary text-md">Login or register to get personalized recommendations!</p>
             <div class="mt-6">
                 <a href="/auth/login" class="bg-primary dark:bg-primary text-white py-2.5 px-6 rounded-full shadow-md hover:bg-indigo-700 dark:hover:bg-indigo-600 transition-colors duration-200 active:scale-95">Login</a>
                 <a href="/auth/register" class="ml-4 bg-transparent text-primary dark:text-primary-dark border border-primary dark:border-primary-dark py-2.5 px-6 rounded-full hover:bg-primary/10 dark:hover:bg-primary-dark/20 transition-colors duration-200">Register</a>
             </div>
             {% endif %}
        </div>
    </div>
</section>

{% if user and recommendations %}
<section class="py-8">
    <h2 class="text-3xl font-bold text-center mb-8 text-text-primary dark:text-white">Recommended for You</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for rec in recommendations %}
        <div class="bg-surface-light dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700 shadow-card-light dark:shadow-card-dark flex flex-col h-full scroll-animate">
             {% if rec.EmbedLink %}
             <div class="relative w-full" style="padding-top: 56.25%;"> {# 16:9 Aspect Ratio #}
                 <iframe class="absolute top-0 left-0 w-full h-full" src="{{ rec.EmbedLink }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
             </div>
             {% elif rec.Link %}
              {# Fallback for non-YouTube links or if embed failed #}
              <a href="{{ rec.Link }}" target="_blank" class="w-full h-40 bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-text-secondary dark:text-text-secondary hover:opacity-75 transition-opacity duration-200">
                  <i class="fa-solid fa-link text-2xl mr-2"></i> Link to Content
              </a>
             {% else %}
              {# Placeholder if no link available #}
              <div class="w-full h-40 bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-text-secondary dark:text-text-secondary">
                  No Media Available
              </div>
             {% endif %}
            <div class="p-4 flex flex-col flex-grow">
                <h3 class="font-semibold text-lg text-text-primary dark:text-white mb-2">{{ rec.Title }}</h3>
                <p class="text-text-secondary dark:text-text-secondary text-sm mb-3 flex-grow">{{ rec.Description | truncate(100) }}</p>
                 <div class="flex justify-between items-center text-sm text-text-secondary dark:text-text-secondary mb-2">
                     <span>Category: {{ rec.Category }}</span>
                     {% if rec.Rating is not none %}
                     <span>Rating: {{ rec.Rating }}/10</span>
                     {% endif %}
                 </div>
                <a href="{{ rec.Link if rec.Link is not none else '#' }}" target="_blank"
                   class="text-sm px-4 py-2 border rounded-full text-primary dark:text-primary border-primary dark:border-primary-dark mt-auto hover:bg-primary/10 dark:hover:bg-primary-dark/20 transition-colors duration-200 text-center">
                    View Content
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<section class="py-8">
    <h2 class="text-3xl font-bold text-center mb-8 text-text-primary dark:text-white">All Courses</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for course in general_courses %}
        <div class="bg-surface-light dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700 shadow-card-light dark:shadow-card-dark flex flex-col h-full scroll-animate">
             {% if course.EmbedLink %}
             <div class="relative w-full" style="padding-top: 56.25%;"> {# 16:9 Aspect Ratio #}
                 <iframe class="absolute top-0 left-0 w-full h-full" src="{{ course.EmbedLink }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
             </div>
             {% elif course.Link %}
              {# Fallback for non-YouTube links or if embed failed #}
              <a href="{{ course.Link }}" target="_blank" class="w-full h-40 bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-text-secondary dark:text-text-secondary hover:opacity-75 transition-opacity duration-200">
                  <i class="fa-solid fa-link text-2xl mr-2"></i> Link to Content
              </a>
             {% else %}
              {# Placeholder if no link available #}
              <div class="w-full h-40 bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-text-secondary dark:text-text-secondary">
                  No Media Available
              </div>
             {% endif %}
            <div class="p-4 flex flex-col flex-grow">
                <h3 class="font-semibold text-lg text-text-primary dark:text-white mb-2">{{ course.Title }}</h3>
                <p class="text-text-secondary dark:text-text-secondary text-sm mb-3 flex-grow">{{ course.Description | truncate(100) }}</p>
                 <div class="flex justify-between items-center text-sm text-text-secondary dark:text-text-secondary mb-2">
                     <span>Category: {{ course.Category }}</span>
                     {% if course.Rating is not none %}
                     <span>Rating: {{ course.Rating }}/10</span>
                     {% endif %}
                 </div>
                <a href="{{ course.Link if course.Link is not none else '#' }}" target="_blank"
                   class="text-sm px-4 py-2 border rounded-full text-primary dark:text-primary border-primary dark:border-primary-dark mt-auto hover:bg-primary/10 dark:hover:bg-primary-dark/20 transition-colors duration-200 text-center">
                    View Content
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="flex justify-center mt-8 space-x-2">
        {% if current_page > 1 %}
            <a href="?page={{ current_page - 1 }}&per_page={{ per_page }}"
               class="px-4 py-2 border rounded-md text-primary dark:text-primary-dark border-primary dark:border-primary-dark hover:bg-primary/10 dark:hover:bg-primary-dark/20 transition-colors">Previous</a>
        {% else %}
            <span class="px-4 py-2 border rounded-md text-text-secondary dark:text-text-secondary border-gray-300 dark:border-gray-600 cursor-not-allowed opacity-50">Previous</span>
        {% endif %}

        {% for page_num in range(1, total_pages + 1) %}
            <a href="?page={{ page_num }}&per_page={{ per_page }}"
               class="px-4 py-2 border rounded-md {% if page_num == current_page %}bg-primary dark:bg-primary text-white{% else %}text-primary dark:text-primary-dark border-primary dark:border-primary-dark hover:bg-primary/10 dark:hover:bg-primary-dark/20{% endif %} transition-colors">
                {{ page_num }}
            </a>
        {% endfor %}

        {% if current_page < total_pages %}
            <a href="?page={{ current_page + 1 }}&per_page={{ per_page }}"
               class="px-4 py-2 border rounded-md text-primary dark:text-primary-dark border-primary dark:border-primary-dark hover:bg-primary/10 dark:hover:bg-primary-dark/20 transition-colors">Next</a>
        {% else %}
            <span class="px-4 py-2 border rounded-md text-text-secondary dark:text-text-secondary border-gray-300 dark:border-gray-600 cursor-not-allowed opacity-50">Next</span>
        {% endif %}
    </div>
</section>

{% endblock %}
